Great to hear it's working! I've fixed both issues:

**1. Done Button Random Triggers - Fixed with Better Debouncing**

I've improved the software debouncing in two ways:
- **Increased hardware debounce time** from 300ms to 500ms (in `machine.py` line 162)
- **Added software debouncing check** - The code now verifies the button is actually pressed (not just electrical noise) before triggering the callback

The software check waits 10ms and then verifies the button is still pressed. This filters out brief electrical spikes that can cause false triggers.

**Hardware solution:** You mentioned adding a resistor - that's still a good idea for extra protection. A 10kΩ pull-up resistor (if not already built into the button) or a small capacitor (0.1µF) across the button contacts can help filter noise. But the software fix should handle most cases now.

**2. Bug Fix: Buttons/Pump Stay Enabled After Cancellation**

Fixed! When the done button triggers with no product dispensed, the code was cancelling the transaction but the dispensing loop kept running. Now it properly exits the loop and disables everything.

**What changed:**
- Added a `transaction_complete` flag that the callback sets when done
- The main dispensing loop now checks this flag and exits when transaction is complete or cancelled
- This ensures buttons/pump are disabled when a transaction is cancelled

**To get the fixes:**
Pull the latest code:
```bash
cd ~/soap
git pull origin master
```

Then test it - the done button should be less prone to false triggers, and when it does trigger with no product, it should properly disable everything.

Let me know how it works!
